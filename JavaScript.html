    <script>
      let allAlbums = [];
      const albumsPerPage = 8;
      let currentPage = 1;

      document.addEventListener('DOMContentLoaded', function() {
        showLoader();
        google.script.run.withSuccessHandler(displayData).withFailureHandler(showError).getAlbumData();
      });

      function showLoader() {
        document.getElementById('loader').style.display = 'block';
        document.getElementById('album-grid').style.display = 'none';
        document.getElementById('dashboard').style.display = 'none';
      }

      function hideLoader() {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('album-grid').style.display = 'flex'; // Use flex for row
        document.getElementById('dashboard').style.display = 'flex'; // Use flex for row
      }

      function displayData(data) {
        if (data.error) {
          showError(data.error);
          return;
        }
        
        document.getElementById('total-albums').textContent = data.totalAlbums;
        document.getElementById('total-files').textContent = data.totalFiles;
        
        allAlbums = data.albums;
        
        if(allAlbums.length === 0){
           document.getElementById('album-grid').innerHTML = '<p class="text-center w-100">ไม่พบอัลบั้ม</p>';
        } else {
           renderPage(currentPage);
        }
        hideLoader();
      }

      function renderPage(page) {
        currentPage = page;
        const grid = document.getElementById('album-grid');
        grid.innerHTML = '';
        
        const start = (page - 1) * albumsPerPage;
        const end = start + albumsPerPage;
        const paginatedAlbums = allAlbums.slice(start, end);

        paginatedAlbums.forEach(album => {
          const card = `
            <div class="col">
              <div class="card h-100 shadow-sm album-card">
                <div class="card-body text-center">
                  <i class="fas fa-folder-open fa-3x text-primary mb-3"></i>
                  <h5 class="card-title text-truncate" title="${album.name}">${album.name}</h5>
                  <p class="card-text mb-1"><small><i class="fas fa-file"></i> ${album.fileCount} ไฟล์</small></p>
                  <p class="card-text"><small><i class="fas fa-hdd"></i> ${album.totalSizeMB} MB</small></p>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                  <a href="${BASE_URL}?page=album&folderId=${album.id}" class="btn btn-sm btn-outline-primary">เปิดอัลบั้ม</a>
                  <button class="btn btn-sm btn-outline-secondary" onclick="copyLink('${album.shareLink}', this)">
                    <i class="fas fa-copy"></i>
                  </button>
                </div>
              </div>
            </div>`;
          grid.innerHTML += card;
        });
        setupPagination();
      }      

      function setupPagination() {
        const pageCount = Math.ceil(allAlbums.length / albumsPerPage);
        const pagination = document.getElementById('pagination');
        pagination.innerHTML = '';

        if (pageCount <= 1) return;

        for (let i = 1; i <= pageCount; i++) {
          const liClass = (i === currentPage) ? 'page-item active' : 'page-item';
          const pageItem = `<li class="${liClass}"><a class="page-link" href="#" onclick="renderPage(${i})">${i}</a></li>`;
          pagination.innerHTML += pageItem;
        }
      }

      function copyLink(link, element) {
          navigator.clipboard.writeText(link).then(() => {
              const originalIcon = element.innerHTML;
              element.innerHTML = '<i class="fas fa-check"></i>';
              setTimeout(() => {
                  element.innerHTML = originalIcon;
              }, 1500);
              Swal.fire({
                  icon: 'success',
                  title: 'คัดลอกลิงก์แล้ว!',
                  toast: true,
                  position: 'top-end',
                  showConfirmButton: false,
                  timer: 1500,
                  timerProgressBar: true
              });
          }).catch(err => {
              showError('ไม่สามารถคัดลอกลิงก์ได้: ' + err);
          });
      }

      function showError(error) {
        hideLoader();
        Swal.fire({
          icon: 'error',
          title: 'เกิดข้อผิดพลาด',
          text: error.toString()
        });
        console.error(error);
      }
    </script>
